{% extends "config_base.html" %}

{% block page_title %}General Settings{% endblock %}
{% block content_title %}General Settings{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto"> {# Constrain width for readability #}
    {# Use blueprint name in url_for #}
    <form action="{{ url_for('config_bp.config_general') }}" method="POST">

        {# Slideshow Settings Section #}
        <div class="config-section">
            <h2>Slideshow Settings</h2>
            {# Image Settings #}
            <h3 class="text-base font-medium text-gray-400 mb-3 mt-2 border-b border-gray-700 pb-1">Image Display</h3>
            <div class="grid-cols-form mb-4">
                <div class="form-group">
                    <label for="duration_seconds">Image Duration (seconds)</label>
                    <input type="number" id="duration_seconds" name="duration_seconds" min="1" value="{{ config.slideshow.duration_seconds }}" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="transition_effect">Image Transition Effect</label>
                    <select id="transition_effect" name="transition_effect" class="form-select">
                        <option value="fade" {% if config.slideshow.transition_effect == 'fade' %}selected{% endif %}>Fade</option>
                        <option value="slide" {% if config.slideshow.transition_effect == 'slide' %}selected{% endif %}>Slide (Basic)</option>
                        <option value="kenburns" {% if config.slideshow.transition_effect == 'kenburns' %}selected{% endif %}>Ken Burns (Zoom/Pan)</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="image_scaling">Image Scaling</label>
                    <select id="image_scaling" name="image_scaling" class="form-select">
                        <option value="cover" {% if config.slideshow.image_scaling == 'cover' %}selected{% endif %}>Cover (Fill Screen)</option>
                        <option value="contain" {% if config.slideshow.image_scaling == 'contain' %}selected{% endif %}>Contain (Fit Screen)</option>
                    </select>
                </div>
                {# Placeholder for spacing if needed #}
                <div></div>
            </div>

            {# Video Settings (NEW SECTION) #}
            <h3 class="text-base font-medium text-gray-400 mb-3 mt-4 border-b border-gray-700 pb-1">Video Playback</h3>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div class="form-group">
                    <label for="video_scaling">Video Scaling</label>
                    <select id="video_scaling" name="video_scaling" class="form-select">
                        <option value="contain" {% if config.slideshow.video_scaling == 'contain' %}selected{% endif %}>Contain (Fit Screen, Default)</option>
                        <option value="cover" {% if config.slideshow.video_scaling == 'cover' %}selected{% endif %}>Cover (Fill Screen)</option>
                    </select>
                </div>
                {# Checkboxes for boolean options #}
                <div class="form-group md:col-span-2 grid grid-cols-2 sm:grid-cols-4 gap-4 pt-2">
                     <label class="inline-flex items-center">
                        <input type="checkbox" id="video_autoplay" name="video_autoplay" class="form-checkbox" {% if config.slideshow.video_autoplay %}checked{% endif %}>
                        <span class="checkbox-label">Autoplay</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="video_loop" name="video_loop" class="form-checkbox" {% if config.slideshow.video_loop %}checked{% endif %}>
                        <span class="checkbox-label">Loop</span>
                    </label>
                     <label class="inline-flex items-center">
                        <input type="checkbox" id="video_muted" name="video_muted" class="form-checkbox" {% if config.slideshow.video_muted %}checked{% endif %}>
                        <span class="checkbox-label">Start Muted</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="video_show_controls" name="video_show_controls" class="form-checkbox" {% if config.slideshow.video_show_controls %}checked{% endif %}>
                        <span class="checkbox-label">Show Controls</span>
                    </label>
                </div>
            </div>

             {# General Order Setting #}
             <h3 class="text-base font-medium text-gray-400 mb-3 mt-4 border-b border-gray-700 pb-1">General Order</h3>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                 <div class="form-group">
                    <label for="image_order">Media Display Order</label> {# Changed label slightly #}
                    <select id="image_order" name="image_order" class="form-select">
                        <option value="sequential" {% if config.slideshow.image_order == 'sequential' %}selected{% endif %}>Sequential (Upload Order)</option>
                        <option value="random" {% if config.slideshow.image_order == 'random' %}selected{% endif %}>Random</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">Applies to both images and videos.</p>
                </div>
             </div>
        </div>

        {# Widgets Section (No changes needed here) #}
        <div class="config-section">
            <h2>Widgets</h2>
             <div class="grid grid-cols-1 gap-y-6"> {# Single column layout for widgets #}
                <div class="form-group border-b border-gray-700 pb-4">
                     <label class="inline-flex items-center">
                        <input type="checkbox" id="time_widget_enabled" name="time_widget_enabled" class="form-checkbox" {% if config.widgets.time.enabled %}checked{% endif %}>
                        <span class="checkbox-label font-medium">Enable Time Widget</span>
                    </label>
                </div>
                <div class="form-group border-b border-gray-700 pb-4">
                    <label class="inline-flex items-center mb-3">
                        <input type="checkbox" id="weather_widget_enabled" name="weather_widget_enabled" class="form-checkbox" {% if config.widgets.weather.enabled %}checked{% endif %}>
                        <span class="checkbox-label font-medium">Enable Weather Widget</span>
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pl-6"> {# Indent options #}
                        <div class="form-group mb-0">
                            <label for="weather_location">Location (e.g., City, ST or Zip)</label>
                            <input type="text" id="weather_location" name="weather_location" value="{{ config.widgets.weather.location }}" class="form-input">
                        </div>
                         <div class="form-group mb-0 md:col-start-2">
                            <p class="mt-1 text-sm text-gray-400 md:pt-6"> {# Adjust padding #}
                                Note: The OpenWeatherMap API key must be set using the <code class="bg-gray-600 px-1 rounded text-xs">OPENWEATHERMAP_API_KEY</code> environment variable. Get a free key from <a href="https://openweathermap.org/" target="_blank" rel="noopener noreferrer" class="text-indigo-400 hover:underline">openweathermap.org</a>.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="form-group"> {# No border on last item #}
                     <label class="inline-flex items-center mb-3">
                        <input type="checkbox" id="rss_widget_enabled" name="rss_widget_enabled" class="form-checkbox" {% if config.widgets.rss.enabled %}checked{% endif %}>
                        <span class="checkbox-label font-medium">Enable RSS Ticker</span>
                    </label>
                    <div class="pl-6 space-y-4"> {# Indent options and add spacing #}
                        <div class="form-group mb-0">
                            <label for="rss_feed_url">RSS Feed URL</label>
                            <input type="url" id="rss_feed_url" name="rss_feed_url" value="{{ config.widgets.rss.feed_url }}" class="form-input" placeholder="https://example.com/feed.xml">
                        </div>
                        <div class="form-group mb-0">
                            <label for="rss_scroll_speed">Scroll Speed</label>
                            <select id="rss_scroll_speed" name="rss_scroll_speed" class="form-select md:w-1/2"> {# Limit width #}
                                <option value="slow" {% if config.widgets.rss.scroll_speed == 'slow' %}selected{% endif %}>Slow</option>
                                <option value="medium" {% if config.widgets.rss.scroll_speed == 'medium' %}selected{% endif %}>Medium</option>
                                <option value="fast" {% if config.widgets.rss.scroll_speed == 'fast' %}selected{% endif %}>Fast</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Display Options Section (No changes needed here) #}
        <div class="config-section">
            <h2>Display Options</h2>
             <div class="grid grid-cols-1 gap-y-6"> {# Single column layout #}
                <div class="form-group border-b border-gray-700 pb-4">
                     <label class="inline-flex items-center mb-3">
                        <input type="checkbox" id="watermark_enabled" name="watermark_enabled" class="form-checkbox" {% if config.watermark.enabled %}checked{% endif %}>
                        <span class="checkbox-label font-medium">Enable Watermark</span>
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pl-6"> {# Indent options #}
                         <div class="form-group mb-0">
                            <label for="watermark_text">Watermark Text</label>
                            <input type="text" id="watermark_text" name="watermark_text" value="{{ config.watermark.text }}" class="form-input">
                        </div>
                        <div class="form-group mb-0">
                            <label for="watermark_position">Watermark Position</label>
                            <select id="watermark_position" name="watermark_position" class="form-select">
                                <option value="top-left" {% if config.watermark.position == 'top-left' %}selected{% endif %}>Top Left</option>
                                <option value="top-right" {% if config.watermark.position == 'top-right' %}selected{% endif %}>Top Right</option>
                                <option value="bottom-left" {% if config.watermark.position == 'bottom-left' %}selected{% endif %}>Bottom Left</option>
                                <option value="bottom-right" {% if config.watermark.position == 'bottom-right' %}selected{% endif %}>Bottom Right</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group"> {# No border on last item #}
                    <label class="inline-flex items-center mb-3">
                        <input type="checkbox" id="burn_in_prevention_enabled" name="burn_in_prevention_enabled" class="form-checkbox" {% if config.burn_in_prevention.enabled %}checked{% endif %}>
                        <span class="checkbox-label font-medium">Enable Burn-in Prevention (Pixel Shift)</span>
                    </label>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 pl-6"> {# Indent options #}
                         <div class="form-group mb-0">
                            <label>Elements to Shift</label>
                            <div class="mt-2 space-y-1">
                                {% set bip_elements = config.burn_in_prevention.elements or [] %}
                                <label class="flex items-center"> <input type="checkbox" id="bip_watermark" name="burn_in_elements" value="watermark" class="form-checkbox" {% if 'watermark' in bip_elements %}checked{% endif %}><span class="checkbox-label">Watermark</span> </label>
                                <label class="flex items-center"> <input type="checkbox" id="bip_time" name="burn_in_elements" value="time" class="form-checkbox" {% if 'time' in bip_elements %}checked{% endif %}><span class="checkbox-label">Time</span> </label>
                                 <label class="flex items-center"> <input type="checkbox" id="bip_weather" name="burn_in_elements" value="weather" class="form-checkbox" {% if 'weather' in bip_elements %}checked{% endif %}><span class="checkbox-label">Weather</span> </label>
                                <label class="flex items-center"> <input type="checkbox" id="bip_rss" name="burn_in_elements" value="rss" class="form-checkbox" {% if 'rss' in bip_elements %}checked{% endif %}><span class="checkbox-label">RSS Ticker</span> </label>
                            </div>
                        </div>
                        <div class="form-group mb-0">
                            <label for="burn_in_interval_seconds">Shift Interval (seconds)</label>
                            <input type="number" id="burn_in_interval_seconds" name="burn_in_interval_seconds" min="1" value="{{ config.burn_in_prevention.interval_seconds }}" required class="form-input">
                        </div>
                         <div class="form-group mb-0">
                            <label for="burn_in_strength_pixels">Shift Strength (pixels)</label>
                            <input type="number" id="burn_in_strength_pixels" name="burn_in_strength_pixels" min="1" max="10" value="{{ config.burn_in_prevention.strength_pixels }}" required class="form-input">
                        </div>
                    </div>
                </div>
             </div>
        </div>

        <div class="mt-6 text-right">
            <button type="submit" class="btn btn-primary">Save General Settings</button>
        </div>
    </form>
</div>
{% endblock %}
